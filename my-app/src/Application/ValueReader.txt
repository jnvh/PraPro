import { useMap } from '@terrestris/react-geo';
import ImageWMS from 'ol/source/ImageWMS';
import {getCurrentLayerName} from './Drawer/IndikatorGroup';
import config from '../configs/config.json'

export function GetRes():number {
    const map = useMap();
    const resolution =map.getView().getResolution();
    if(typeof resolution==="number" ){
        return resolution; 
    };
    return 0;
};

export const getSource =()=> {
    const wmsSource = new ImageWMS({
        url: config.Geoserver,
        params: { 'LAYERS': getCurrentLayerName() },
        serverType: 'geoserver'
    });
    return wmsSource;    
}

export const getPixelValue =():void=>{
    const map = useMap();     
    
    map.on('singleclick', function valueListener(event) {
        const url = getSource().getFeatureInfoUrl(
            event.coordinate,
            GetRes(),
            'ESPG:3035',
            {'INFO_FORMAT': 'text/html'}
        );

        if (url) {
            fetch(url)
              .then((response) => response.text())
              .then((info) => {
                console.log(info);
              });
          }
    }); 
};

export default getPixelValue; 